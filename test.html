<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Picker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
    <script>
        // Hardcoded credentials from your .env file
        const DEVELOPER_KEY = 'AIzaSyBBtRX5-89QQrrT1rd3BDxKZwVFJ1ocvrw'; 
        const ACCESS_TOKEN = 'ya29.a0AW4XtxgnaDauYKbA-bxO1CNh69j84HWP4O9zsjzf-x96xyosnBnCMjuMro2WhI23Hi0gvVVckJWMQgms7Y5oK1DlJJoCWnyzrUPSR-rv3b8JqNCunDA1y4JpoeSvCrlL-qhehxVbvBx3zOgGyr50RChH4Li-FIq5MvoNPskQaCgYKAT8SARUSFQHGX2Mizai-QusE83TpxQhfCyLixw0175'; 
        let access_token = null;
        let gapi_loaded = false;
        let picker_loaded = false;


        // Define these functions before loading the scripts
        function onGapiLoad() {
            gapi_loaded = true;
            if (picker_loaded) {
                initializeApp();
            } else {
                console.log('Google Picker not loaded yet');
            }
        }

        function onPickerLoad() {
            picker_loaded = true;
            if (gapi_loaded) {
                initializeApp();
            } else {
                console.log('Google API not loaded yet');
            }
        }

        function initializeApp() {
            initializeGAPI();
        }

        function initializeGAPI() {
            if (!DEVELOPER_KEY || DEVELOPER_KEY === 'YOUR_API_KEY_HERE') {
                updateStatus('❌', 'Configuration Error', 'Please set your DEVELOPER_KEY in the script', 'error');
                return;
            }

            if (!ACCESS_TOKEN || ACCESS_TOKEN === 'YOUR_ACCESS_TOKEN_HERE') {
                updateStatus('❌', 'Configuration Error', 'Please set your ACCESS_TOKEN in the script', 'error');
                return;
            }
            console.log('Google API initialized');
            access_token = ACCESS_TOKEN;
            openPicker();
        }

        function openPicker() {
            if (!access_token) {
                return;
            }
            try {
                // Create a custom view for spreadsheets, CSV, and XLSX files
                const spreadsheetView = new google.picker.DocsView()
                    .setMimeTypes('application/vnd.google-apps.spreadsheet,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/csv')
                    .setMode(google.picker.DocsViewMode.LIST);
                
                // Create picker
                const picker = new google.picker.PickerBuilder()
                    .setDeveloperKey(DEVELOPER_KEY)
                    .setOAuthToken(access_token)
                    .addView(spreadsheetView)
                    .setTitle('Select a Spreadsheet')
                    .enableFeature(google.picker.Feature.NAV_HIDDEN)
                    .setCallback(pickerCallback)
                    .build();

                picker.setVisible(true);

            } catch (error) {
                console.error('Picker error:', error);
            }
        }

        function pickerCallback(data) {
            console.log('Picker callback:', data);

            if (data.action === google.picker.Action.PICKED) {
                const file = data.docs[0];
                
                
                // Log selected files
                console.log('Selected file:', {
                        name: file.name,
                        id: file.id,
                        mimeType: file.mimeType,
                        url: file.url
                    });
                
            } else if (data.action === google.picker.Action.CANCEL) {
                console.log('Picker cancelled');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const apiScript = document.createElement('script');
            const pickerScript = document.createElement('script');
            apiScript.src = 'https://apis.google.com/js/api.js';
            pickerScript.src = 'https://apis.google.com/js/picker.js';
            apiScript.onload = () => {
                gapi.load('picker', () => {
                    onGapiLoad();
                });
            };
            pickerScript.onload = () => {
                onPickerLoad();
            };
            document.head.appendChild(apiScript);
            document.head.appendChild(pickerScript);
        });

    </script>
</body>
</html>